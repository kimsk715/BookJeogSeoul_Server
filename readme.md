# 독후감 공유 및 기부 중개 플랫폼.

# 1. 기획 의도

<img src="https://github.com/kimsk715/kimsk715/blob/e5129335eb79e35adecd2e1ad74bf416261f3602/%EB%B6%81%EC%A0%81%EC%84%9C%EC%9A%B8_%EA%B8%B0%ED%9A%8D%EC%9D%98%EB%8F%84.png">

대한민국 성인의 독서량이 감소해가는 추세를 해결하는 동시에, 독서 활동을 기부할 수 있는 기회와 연결하여, 독서를 생산적인 활동을 만드는 것을 목표로 '북적서울' 이라는 플랫폼을 기획하였습니다.

# 2. 기대 효과

<img src="https://github.com/kimsk715/kimsk715/blob/e5129335eb79e35adecd2e1ad74bf416261f3602/%EB%B6%81%EC%A0%81%EC%84%9C%EC%9A%B8_%EA%B8%B0%EB%8C%80%ED%9A%A8%EA%B3%BC.png">

대한민국 성인의 독서율을 개선하고, 도서를 접하기 힘든 이들에게 독서의 기회를 골고루 제공할 수 있으며, 기부에 대한 접근성을 높일 수 있을 것으로 예상됩니다.

# 3. 프로젝트 사용 Tool

-   Java<br>
-   Spring Boot<br>
-   FastAPI<br>
-   python<br>
-   Java Script<br>
-   tomcat<br>
-   MySQL<br>
-   MyBatis<br>
-   Visual Studio Code<br>
-   InteliJ<br>
-   PyCharm<br>
-   Postman<br>
-   Quartz<br>
-   DBeaver<br>
-   Sourcetree<br>
-   Thymeleaf<br>
-   JSON<br>
-   Ajax<br>
-   JDK 17.0.15<br>
-   Kakao DEVELOPER API<br>
-   SMTP Gmail API<br>
-   OpenAI Platform
-   OpenAPI<br>
-   git, github<br>
-   Slack<br>

# 4. ERD

<img src="https://github.com/kimsk715/kimsk715/blob/cf030030f710cda685d357f6b89dc69dbd418b3f/bjseoul_ERD.png">

# 5. 담당 업무

## 5-1. 퍼블리싱

<img src="https://github.com/kimsk715/kimsk715/blob/09e60ba1051b86db9645da6b0edf8b705b5d9f8e/bjseoul_publishing.png">

### ※ 관리자 페이지

    ▶ 전체 독후감 관리
    ▶ 이 달의 독후감 관리
    ▶ 개인 회원 관리
    ▶ 후원 단체 관리
    ▶ 도서 관리
    ▶ 개인 후원 관리
    ▶ 토론 게시판 관리
    ▶ 후원대상 관리
    ▶ 개인문의 관리
    ▶ 단체문의 관리
    ▶ 댓글 신고 관리
    ▶ 독후감 신고 관리
    ▶ 공지 관리
    ▶ 관리자 메뉴

### ※ 독서 토론 게시판

    ▶ 메인 페이지
    ▶ 게시글 상세보기
    

### ※ 기부 게시판

    ▶ 후원대상 게시판 메인페이지
    ▶ 후원대상 게시글 작성/수정
    ▶ 후원대상 게시글 상세보기
    ▶ 이 주의 기부도서 전체보기
    ▶ 후원인증 게시판 메인페이지
    ▶ 후원인증 게시글 작성/수정
    ▶ 후원인증 게시글 상세보기    

### ※ 고객센터
    
    ▶ 문의하기
    ▶ 문의내역
    ▶ 공지 및 이벤트
    ▶ 이벤트 상세보기

### ※ 알림센터
    

## 5-2 백엔드

<img src="https://github.com/kimsk715/kimsk715/blob/09e60ba1051b86db9645da6b0edf8b705b5d9f8e/bjseoul_server1.png">
<img src="https://github.com/kimsk715/kimsk715/blob/09e60ba1051b86db9645da6b0edf8b705b5d9f8e/bjseoul_server2.png">

### ※ 관리자 페이지

    ▶ 개인 회원
        - 개인 회원 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 개인 회원 회원명 검색 처리(Restful)
    
    ▶ 단체 회원
        - 단체 회원 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 단체 회원 단체명 검색 처리(Restful)
        - 단체 회원 신규 등록(Restful)
    
    ▶ 도서 관리
        - 도서 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - ISBN, 도서명, 작가명 검색 처리(Restful)
        - 서울 공공 데이터 API로 도서 조회
        - 관리자 선정도서 선정
        - 관리자 선정도서 임시 목록 조회
        - OpenAI Platform를 통한 독서 토론 주제 생성 및 입력
    
    ▶ 개인 문의
        - 개인 문의 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 개인 문의 이름 회원명 처리(Restful)
        - 개인 문의 등록일 및 처리상태 별 필터링 처리(Restful)
        - 개인 문의 상세보기 버튼 클릭 시 상세 정보 모달 팝업(Restful)
        - 개인 문의 상세보기 모달 팝업에서 문의 답변(Restful)
    
    ▶ 단체 문의
        - 단체 문의 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 단체 문의 문의 제목 및 문의 내용 검색 처리(Restful)
        - 단체 문의 상세보기 버튼 클릭 시 상세 정보 모달 팝업(Restful)
        - 단체 문의 상세보기 모달 팝업에서 문의 답변(Restful)    
        
    ▶ 공지사항
        - 공지사항 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 공지사항 제목 및 내용 검색 처리(Restful)
        - 공지사항 상세보기 버튼 클릭 시 상세 정보 모달 팝업(Restful)
        - 공지사항 상세보기 모달 팝업에서 공지 수정(Restful)
        - 공지사항 작성 버튼 클릭 시 신규 공지 작성
    
    ▶ 독후감 관리
        - 전체 독후감 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 독후감 키워드 검색 처리(Restful)
        - 이 달의 독후감 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 이 달의 독후감 키워드 검색 처리(Restful)
    
    ▶ 도서 관리
        - 도서 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - ISBN, 도서명, 작가명 검색 처리(Restful)
        - 서울 공공 데이터 API로 도서 조회
        - 관리자 선정도서 선정
        - 관리자 선정도서 임시 목록 조회
        - OpenAI Platform를 통한 독서 토론 주제 생성 및 입력
    
    ▶ 개인 문의
        - 개인 문의 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 개인 문의 이름 회원명 처리(Restful)
        - 개인 문의 등록일 및 처리상태 별 필터링 처리(Restful)
        - 개인 문의 상세보기 버튼 클릭 시 상세 정보 모달 팝업(Restful)
        - 개인 문의 상세보기 모달 팝업에서 문의 답변(Restful)
    
    ▶ 단체 문의
        - 단체 문의 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 단체 문의 문의 제목 및 문의 내용 검색 처리(Restful)
        - 단체 문의 상세보기 버튼 클릭 시 상세 정보 모달 팝업(Restful)
        - 단체 문의 상세보기 모달 팝업에서 문의 답변(Restful)    
        
    ▶ 공지 관리
        - 공지사항 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 공지사항 제목 및 내용 검색 처리(Restful)
        - 공지사항 상세보기 버튼 클릭 시 상세 정보 모달 팝업(Restful)
        - 공지사항 상세보기 모달 팝업에서 공지 수정(Restful)
        - 공지사항 작성 버튼 클릭 시 신규 공지 작성
    
    ▶ 독후감 관리
        - 전체 독후감 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 독후감 키워드 검색 처리(Restful)
        - 이 달의 독후감 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 이 달의 독후감 키워드 검색 처리(Restful)
    
    ▶ 댓글 신고 관리
        - 댓글 신고 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 댓글 내용 검색 처리(Resftul)
        - 신고 상세보기 버튼 클릭 시 상세 정보 모달 팝업(Restful)
        - 댓글 작성자 및 댓글에 대한 제제 처리(Restful)
    
    ▶ 독후감 신고 관리    
        - 독후감 신고 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 독후감 제목 및 내용 검색 처리(Resftul)
        - 신고 상세보기 버튼 클릭 시 상세 정보 모달 팝업(Restful)
        - 독후감 작성자 및 독후감에 대한 제재 처리(Restful)

    ▶ 개인 후원
        - 개인 후원 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 도서명 및 회원명 검색 처리(Resftul)
        - 수취 상태 변경 버튼 (Restful) 
        
    ▶ 후원 대상 관리
        - 후원 대상 게시글 10개 단위로 조회 및 페이징 처리(Restful)
        - 게시글 제목 및 내용 검색 처리(Restful)
        
    ▶ 토론 게시판 관리
        - 토론 게시글 10개 단위로 조회 및 페이징 처리(Restful) 
        
    ▶ 관리자 메뉴
        - 관리자 목록 10개 단위로 조회 및 페이징 처리(Restful)
        - 관리자 이름 검색 처리(Restful)
        - 관리자 신규 등록(Restful)
   
### ※ 공지 및 이벤트

    ▶ 공지 및 이벤트 목록 조회
    ▶ 공지 영역 시 해당 공지 내용 노출.
    ▶ 이벤트 상세보기
    ▶ 이 달의 독후감 투표 기능.

### ※ 토론 게시판

    ▶ 토론 게시글 전체 조회
    ▶ 토론 게시글 상세보기
    ▶ 댓글 작성/삭제
    ▶ 댓글 신고
  

### ※ 기부 게시판

    ▶ 후원 대상 게시글 조회
    ▶ 후원 대상 게시글 상세 보기
    ▶ 후원 대상 책갈피(마일리지) 투표
    ▶ 후원 대상 게시글 작성/수정
    ▶ 후원 인증 게시글 조회
    ▶ 후원 인증 게시글 상세 보기
    ▶ 후원 인증 게시글 작성/수정
    ▶ 댓글 작성/삭제
    ▶ 댓글 신고
  

### ※ Quartz

    ▶ 관리자 추천 도서 선정(매 달 1일)
    ▶ 이 달의 독후감 투표 대상 선정(매 달 20일)
    ▶ 이 달의 독후감 최종 선정(매 달 30일)
    ▶ 이 달의 독후감 투표 게시글 생성
    ▶ 이 달의 독후감 선정 결과 게시글 생성
    

# 6. 느낀점

## 6-1. 어려웠던 점

지난 프로젝트에서 전체적인 프로젝트의 관리가 어려웠기 때문에, 이번 프로젝트에서는 3-tier 방식을 최대한 준수하고,
VO와 DTO도 각각의 목적에 맞게 적용하는 것을 목표로 프로젝트를 진행하였습니다. 기존에는 서비스를 구현하는 데 
급급하여 VO와 DTO의 목적에 맞지 않게 활용하였기 때문에, 이러한 형식에 맞춰 개발을 진행하는 것이 어색하기도 하고,
3-tier의 어느 계층에서 DTO를 이용하는 것인지도 자주 혼동하였습니다. 처음 몇 개의 서비스를 구현하는 동안에는
개발 속도가 느렸었지만, 차츰 이러한 설계 방식에 익혀가면서, 프로젝트 관리도 수월해졌습니다.

또한 이번 프로젝트에서 처음으로 파일 첨부가 포함된 서비스를 구현하였습니다. 단순하게 파일 첨부를 포함하여
게시글을 업로드하는 것은 어렵지 않았지만, 기존에 작성되어 있는 게시글에서 파일을 추가 혹은 삭제하여 
수정하는 기능을 구현하는 데 있어서 많은 어려움을 겪었습니다.
파일에 대한 정보를 가져온 뒤, 이를 다시 DB에 입력하는 것에 있어서 어떤 방식으로 구현해야 할지 많은
고민을 하였고, 단계별로 실행 결과를 로그로 확인해가면서, 서비스를 구현할 수 있었습니다.



## 6-2. 트러블 슈팅

### 1. 파일 첨부 및 수정 시 외래 키 제약 조건 위반 오류.

<img src="https://github.com/kimsk715/kimsk715/blob/d18435752c7fc10be2a57bfc64e3dcee5281107e/post_edit_error_log.png">


#### 문제 상황

    게시글 수정 시 'Superkey에 해당하는 데이터를 삭제 혹은 수정할 수 없다' 라는 로그와 함께,
    게시글의 수정 사항이 반영되지 않으면서, 기존의 첨부되어있던 파일만 DB에서 제거되는 상황. 
    위의 이미지에서는 삭제 과정에서 오류가 발생하였지만, 첨부를 하는 과정에서도 똑같은 종류의
    오류가 발생하였음.

<img src="https://github.com/kimsk715/kimsk715/blob/b59d4986fb17b0a5525a50ce2943215255b81c7a/%ED%8C%8C%EC%9D%BC_%EC%B2%A8%EB%B6%80_%EC%8A%88%ED%8D%BC%ED%82%A4_%EC%88%9C%EC%84%9C_%EC%98%A4%EB%A5%98.jpg">

##### 파일 첨부 오류 코드

#### 문제 원인

     게시글 수정에서 기존 파일의 제거가 제일 먼저 실행되고, 그 뒤에 기존 파일이 다시 첨부되고 추가된 파일이 첨부되는 방식으로 파일 수정이 
     이뤄졌다. 그 과정에서 하나의 트랜잭션에 묶여있지 않았기 때문에, 새로 첨부하는 코드에서 오류가 발생해도 기존 파일의 삭제는 이미 
     이뤄졌기 때문에 오류가 발생하고 난 뒤에는 게시글의 파일 상태에 오류가 발생한 것이었다. 
     외래 키 제약 조건을 어긴 상태로 실행되어 발생한 오류는 위의 그림에서 usegeneratedkey를 통해 생성된 id를 슈퍼키의 ID로 먼저 입력하고
     서브키를 입력해야 하는데, 슈퍼키가 생성되지 않은 상태에서 서브키의 ID를 입력하려고 해서 오류가 발생하였다.

<img src="https://github.com/kimsk715/kimsk715/blob/8f3fb2b11d826eaa66cf7444c94efd38b3d329a5/%ED%8C%8C%EC%9D%BC_%EC%B2%A8%EB%B6%80_%EC%8A%88%ED%8D%BC%ED%82%A4_%EC%88%9C%EC%84%9C_%EC%BD%94%EB%93%9C.jpg">

#### 해결 방법

     게시글의 파일 상태에 발생한 오류는, 기존 파일의 삭제와 (기존 파일 + 새로운 파일)의 첨부가 한 트랜잭션에서 이뤄지도록 하여,
     오류 발생 시 DB가 수정되지 않도록 방지하였다. 
     
     그리고 코드의 실행 순서를 바꾸어,
     첨부는 슈퍼키 --> 서브키, 삭제는 서브키 --> 슈퍼키 순서대로 실행되도록 수정하였다.

### 2. API 사용 시, parameter 에러.

#### ♨ 문제 상황 ♨

     일부 parameter가

#### 문제 원인

     API로부터 데이터를 요청할 때, 전체 parameter를 받을 VO가 있어야 하는데, 서비스에 필요한 데이터만 필드에 선언한 VO를 사용하여

#### 해결 방법

     기업 이미지가 담긴 테이블과 전체 파일들에 대한 정보가 담긴 테이블 join하는 과정에서 테스트를 위해 사용했던 고정된 COMPANY_ID를 
     제거하지 않아 발생했던 오류로, 테스트용 데이터를 제거하였더니 해결되었다.

### 3. 후원 대상 게시판 접속 불가 오류.

#### 문제 상황

     게시글을 정상적으로 DB로부터 조회해왔음에도 후원 대상 게시판에 접속이 불가능하던 상황.

#### 문제 원인

     후원 대상 게시판에는 이 주의 기부도서 목록이 포함되어 있는데, 이 곳에 서울도서관 소장자료에 포함되지 않은 잡지 등의 서적을 포함시키면, api가 데이터를 조회하지 못하며 예외가 발생하여, 접속이 되지 않았음.

#### 해결 방법

     테스트를 위해 넣었던 더미 데이터를 모두 제거한 뒤, 서울도서관에 소장되어 있던 자료를 기반으로 테스트를 진행하였고, 페이지에 정상적으로 접속되는 것을 확인하였다.

### 4. API 사용한 조회에서 페이징 처리 오류.

#### 문제 상황

     프로그램 목록을 조회해오는 과정에서 썸네일이 불러와지지 않는 상황

#### 문제 원인

     썸네일을 가져오는 데 DB에 있는 기업 이미지의 filePath와 fileName이라는 두 개의 파라미터를 통해 이미지를 출력하는 데, 
     두 값이 모두 null이어서, 썸네일이 출력되지 않았다.

#### 해결 방법

     파일에 대한 정보를 담고 있는 DTO에 fileName과 filePath가 선언되어 있지 않아서, Service 계층에서 
     해당 데이터들이 누락되어서,  Controller에서 로그를 확인할 때, 해당 값들이 null로 나타났다.
     DTO에 해당 필드를 추가하고 테스트를 한 결과 정상적으로 썸네일이 나타났다.

### 5. 댓글 멘션 시, 특정 조건에서 여러 명이 동시에 멘션되고, 해당 정보가 재접속 전까지 남아있던 오류

#### 문제 상황

     특정 게시글에서 멘션 가능한 회원 목록이 2명 이상인 경우에 발생하였다.
     멘션하기를 원하는 회원을 클릭하였을 때, 화면 상으로는 1명이 멘션되지만, 실제로는 2명 혹은 그 이상이 멘션되고, 해당 페이지를 나가기 전까지 멘션 기능이 작동하지 않는 오류.

#### 문제 원인

     세션에 저장된 회원 데이터에서 이력서가 null 인 경우, Thymeleaf를 통해 출력하고자 할 때, null을 찾을 수
     없다는 오류가 발생하면서, 404 페이지로 이동된다.

#### 해결 방법

     세션에 저장된 회원 데이터에서 이력서가 없는 경우에는 Thymeleaf가 실행되지 않도록 th:if 구문을 사용하여, 해당 태그가 있는 부분을
     이력서 작성을 요구하는 텍스트로 대체하도록 했다.

## 6-3. 소감

-

>
